---
title: "Phyloseq"
author: "Rajani"
date: "January 4, 2019"
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(dada2); packageVersion("dada2")
library("phyloseq")
setwd("C:/Users/rthanis/Desktop/16SsequencingForMS")
library(ggplot2)
packageVersion("ggplot2")
library(vegan)
library(permute)
library(lattice)
packageVersion("vegan")
library(MASS)
packageVersion("MASS")
path <- "C:/Users/rthanis/Desktop/16SsequencingForMS"
ps <- readRDS(file.path(path, "ps.RDS"))
```

## Including Plots

You can also embed plots, for example:

```{r}
ps.prop<-transform_sample_counts(ps, function(x) 1000 * x/(sum(x)))
ords.nmds.bray<-ordinate(ps.prop,method = "NMDS",distance = "bray")
plot_ordination(ps.prop,ords.nmds.bray,color = "Species",shape = "CD") + 
  geom_point(size=2.5) + 
  scale_color_manual(values=c( "#DA8D06","#000000","#489BE5", "#F53112","#AE43A7", "#336600")) +
  scale_shape_manual(values = c(19,2))
df = as(sample_data(ps.prop),"data.frame")
df_taxa<-as(otu_table(ps.prop), "matrix")
betad<-betadiver(df_taxa, "z")
mod<-with(df,betadisper(betad,Species))
TukeyHSD(mod)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
(ps_Canine <- subset_samples(ps, Species == "Canine"))
saveRDS(ps_Canine ,"C:/Users/rthanis/Desktop/16SsequencingForMS/ps_Canine.RDS")
ps_Canine
ps.prop_Canine<-transform_sample_counts(ps_Canine, function(x) 1000 * x/(sum(x)))
ords.nmds.bray<-ordinate(ps.prop_Canine,method = "NMDS",distance = "bray")
df = as(sample_data(ps.prop_Canine),"data.frame")
df_taxa<-as(otu_table(ps.prop_Canine), "matrix")
betad<-betadiver(df_taxa, "z")
mod<-with(df,betadisper(betad,CD))
TukeyHSD(mod)
```

```{r}
plot_ordination(ps.prop_Canine,ords.nmds.bray,shape = "CD",color = "Species") + scale_color_manual(values= "#489BE5") + geom_point(size=2.5) + scale_shape_manual(values = c(19,2))
```
```{r}
path <- "C:/Users/rthanis/Desktop/16SsequencingForMS"
ps.prop_CanineAb <- readRDS(file.path(path, "ps.prop_CanineAb.RDS"))
ords.nmds.bray<-ordinate(ps.prop_CanineAb,method = "NMDS",distance = "bray")
df = as(sample_data(ps.prop_CanineAb),"data.frame")
df_taxa<-as(otu_table(ps.prop_CanineAb), "matrix")
betad<-betadiver(df_taxa, "z")
mod<-with(df,betadisper(betad,Ab))
TukeyHSD(mod)
plot_ordination(ps.prop_CanineAb,ords.nmds.bray,color = "Ab",shape = "CD") + 
  geom_point(size=2.5) + 
  scale_color_manual(values=c( "#DA8D06","#000000")) +
  scale_shape_manual(values = c(19,2))
ggsave("C:/Users/rthanis/Desktop/ClinicalProject/ManuscriptPrep/Microbiome/NMDSCanineCDAb.pdf", width = 9, height = 5, units = "in")
```

```{r}
(ps_Equine <- subset_samples(ps, Species == "Equine"))
saveRDS(ps_Equine ,"C:/Users/rthanis/Desktop/16SsequencingForMS/ps_Equine.RDS")
ps_Equine
ps.prop_Equine<-transform_sample_counts(ps_Equine, function(x) 1000 * x/(sum(x)))
ords.nmds.bray<-ordinate(ps.prop_Equine,method = "NMDS",distance = "bray")
df = as(sample_data(ps.prop_Equine),"data.frame")
df_taxa<-as(otu_table(ps.prop_Equine), "matrix")
betad<-betadiver(df_taxa, "z")
mod<-with(df,betadisper(betad,CD))
TukeyHSD(mod)
```

```{r}
plot_ordination(ps.prop_Equine,ords.nmds.bray,shape = "CD",color = "Species") + scale_color_manual(values= "#F53112") + geom_point(size=2.5) + scale_shape_manual(values = c(19,2))

```

```{r}
path <- "C:/Users/rthanis/Desktop/16SsequencingForMS"
ps.prop_CanineAb  <- readRDS(file.path(path, "ps.prop_CanineAb .RDS"))
ps.prop_CanineGI   <- readRDS(file.path(path, "ps.prop_CanineGI  .RDS"))   
ords.nmds.bray<-ordinate(ps.prop_CanineAb,method = "NMDS",distance = "bray")
plot_ordination(ps.prop_CanineAb,ords.nmds.bray,shape = "Ab",color = "Species") + scale_color_manual(values= "#489BE5") + geom_point(size=2.5) + scale_shape_manual(values = c(19,2))
ggsave("C:/Users/rthanis/Desktop/ClinicalProject/ManuscriptPrep/Microbiome/NMDSCanineAb.pdf", width = 9, height = 5, units = "in")
ords.nmds.bray<-ordinate(ps.prop_CanineGI,method = "NMDS",distance = "bray")
plot_ordination(ps.prop_CanineGI,ords.nmds.bray,shape = "GI",color = "Species") + scale_color_manual(values= "#489BE5") + geom_point(size=2.5) + scale_shape_manual(values = c(19,2))
ggsave("C:/Users/rthanis/Desktop/ClinicalProject/ManuscriptPrep/Microbiome/NMDSCanineGI.pdf", width = 9, height = 5, units = "in")

ords.nmds.bray<-ordinate(ps.prop_CanineAb,method = "NMDS",distance = "bray")
plot_ordination(ps.prop_CanineAb,ords.nmds.bray,shape = "CD",color = "Ab") + scale_color_manual(values=c( "#DA8D06","#000000")) +
  scale_shape_manual(values = c(19,2)) + geom_point(size=2.5) + scale_shape_manual(values = c(19,2))
ggsave("C:/Users/rthanis/Desktop/ClinicalProject/ManuscriptPrep/Microbiome/NMDSCanineCDAb.pdf", width = 9, height = 5, units = "in")

ords.nmds.bray<-ordinate(ps.prop_CanineGr,method = "NMDS",distance = "bray")
plot_ordination(ps.prop_CanineGr,ords.nmds.bray,color = "Sex") + scale_color_manual(values=c( "#F53112", "#DA8D06","#489BE5","#000000","#F53112")) +
  scale_shape_manual(values = c(19,2)) + geom_point(size=2.5) + scale_shape_manual(values = c(19,2))
ggsave("C:/Users/rthanis/Desktop/ClinicalProject/ManuscriptPrep/Microbiome/NMDSCanineGr.pdf", width = 9, height = 5, units = "in")

ords.nmds.bray<-ordinate(ps.prop_CanineAge,method = "NMDS",distance = "bray")
plot_ordination(ps.prop_CanineGr,ords.nmds.bray,color = "Age") + scale_color_manual(values=c( "#F53112", "#DA8D06","#489BE5","#000000","#F53112")) +
  scale_shape_manual(values = c(19,2)) + geom_point(size=2.5) + scale_shape_manual(values = c(19,2))
ggsave("C:/Users/rthanis/Desktop/ClinicalProject/ManuscriptPrep/Microbiome/NMDSCanineAge.pdf", width = 9, height = 5, units = "in")

```

```{r}
ords.nmds.bray<-ordinate(ps.prop_CanineGI,method = "NMDS",distance = "bray")
plot_ordination(ps.prop_CanineGI,ords.nmds.bray,shape = "CD",color = "GI") + scale_color_manual(values=c( "#000000","#F53112")) + geom_point(size=2.5) + scale_shape_manual(values = c(19,2))
ggsave("C:/Users/rthanis/Desktop/ClinicalProject/ManuscriptPrep/Microbiome/NMDSCanineCDGI.pdf", width = 9, height = 5, units = "in")
```


```{r}

```

```{r}

```

